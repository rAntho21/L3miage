<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <title>Jaya | Solitaire</title>
</head>
<header>
    <div id="Entete-site">
        <a href="../../index.html"><img src="../../assets/images/logo.png" alt="Logo Jaya"></a>
        <a href="../../index.html">Jaya</a>
        <div>
            <a href="../navigation/connexion.html">Connexion</a>
            <a href="../navigation/inscription.html">Inscription</a>
        </div>
    </div>
    <div id="Menu">
        <ul>
            <li><a href="../navigation/listeJeux.html">Jeux</a></li>
            <li><a href="../navigation/boutique.html">Boutique</a></li>
            <li><a href="../navigation/profil.html">Profil</a></li>
            <li><a href="../navigation/parametres.html">Paramètres</a></li>
            <li><div>SearchBar</div></li>
        </ul>
    </div>

    <style>
        * {
            user-select: none;
        }

        body {
            background-color: black;
            cursor: default;
            user-select: none;
        }

        table {
            margin: 0;
            padding: 0;
            border-collapse: collapse;
        }

        tr {
            margin: 0;
            padding: 0;
            border-collapse: collapse;
        }

        td {
            font-family: sans-serif;
            font-size: 1.0em;
            text-align: center;
            font-weight: bold;
            margin: 0;
            padding: 0;
            border: 1px solid black;
            width: 2em;
            height: 2em;
            border-collapse: collapse;
        }

        tbody {
            margin: 0;
            padding: 0;
        }

        #field {
            background-color: #229933;
            float: left;
            position: relative;
        }

        #field td {
            position: relative;
        }

        #deal {
    margin-top: 200px;
    position: fixed;
    top: 0;
    right: 0;
    width: 75px;
    border-bottom: none;
    background-color: #229933;
    z-index: 999;
}

        

        #deal td {
            border-right: none;
        }

        #four {
            margin-top: 150px;
    position: fixed;
    top: 0;
    left: 0;
    width: 75px;
    border-bottom: none;
    background-color: #229933;
    z-index: 999;
}




        div.bottom {
            border-top: none;
        }

        div.top {
            border-bottom: none;
            width: 16em;
            height: 2em;
            border-left: 10px solid rgba(0, 0, 0, 0);
            margin: 0;
            padding: 0;
        }

        #container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        #game {
            max-width: 500px;
            width: 100%;
        }

        table {
            width: 100%;
            table-layout: fixed;
        }

        td {
            width: 50px;
            height: 30px; /* Ajustement de la hauteur */
            padding: 10px;
        }
    </style>
</header>
<body>
    <div id="container">
        <div id="game">
            <div>
                <<div id="four">
                    <table>
                        <tr>
                            <td style="color: #a33">&#9829;</td>
                        </tr>
                        <tr>
                            <td style="color: #a33">&#9830;</td>
                        </tr>
                        <tr>
                            <td style="color: #000">&#9827;</td>
                        </tr>
                        <tr>
                            <td style="color: #000">&#9824;</td>
                        </tr>
                    </table>
                </div>
                <div class="bottom">
                    <table id="deal">
                        <tr>
                            <td style="box-sizing:border-box;border:1px solid blue;color:lightblue;background-color:#44bb66" id="deck">&#127136;</td>
                        </tr>
                        <tr>
                            <td id="hand" style="background-color:#33aa44"></td>
                        </tr>
                    </table>
                </div>
        </table><table id="field">
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            <tr>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
                <td>
            </tr>
            
                
        </table>
    </div>
</div>
</div>
        <script>
            /*
            // Sélectionnez la table "four"
    var fourTable = document.getElementById("four");

    // Détectez le défilement de la page et ajustez la position de la table "four"
    window.addEventListener("scroll", function() {
    // Obtenez la quantité de défilement verticale
    var scrollTop = window.scrollY || document.documentElement.scrollTop;

    // Ajustez la position de la table "four"
    fourTable.style.top = scrollTop + "px";
    });
*/
            
        cards=[];
        entities=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        suits=['D','H','S','C'];
        z=0;
        for (i=0;i<suits.length;i++) {
            for (j=0;j<entities.length;j++) {
                    cards[z]={};
                    cards[z].suit=suits[i];
                    if (cards[z].suit=='D' || cards[z].suit=='H') {
                        cards[z].color='r';
                    }
                    if (cards[z].suit=='C' || cards[z].suit=='S') {
                        cards[z].color='b';
                    }
                    cards[z].face=entities[j];
                    cards[z].number=j;
                    cards[z].up=false;
                    z++
            }
        }
        for (j=0;j<10;j++) {
            for (i=0;i<cards.length;i++) {
                ri=Math.floor(Math.random()*cards.length);
                tmp=cards[ri];
                cards[ri]=undefined;
                cards[ri]=cards[i];
                cards[i]=undefined;
                cards[i]=tmp
                
                
            }
        }
         
        field=document.getElementById('field');
        tds=field.getElementsByTagName('td');
        fieldcards=[];
         
        for (i=0;i<tds.length;i++) {
            tds[i].i=i;
           
        }
         
        row=0;
        col=0;
         
        for (i=0;i<tds.length;i++) {
            for (j=0;j<7;j++) {
            if (row==j) {
                if (col<=j) {
                    if (col<j) {
                        if (fieldcards[i]==undefined) {
                            card=cards.pop()
                            fieldcards[i]=card;
                        }
                    } else {
                        if (fieldcards[i]==undefined) {
                            card=cards.pop()
                            card.up=true;
                            fieldcards[i]=card;
                            tds[i].setAttribute('draggable','true');
                            tds[i].addEventListener('dragstart',tds[i].d3=function (e) {
                                e.dataTransfer.setData('fromi',this.i);
                            });
                        }
                    }
                }
                if (col==j+1) {
                    //tds[i].style.backgroundColor='#fff';
                    tds[i].addEventListener('dragover',tds[i].d1=function (e) {
                        e.preventDefault();
                        //console.log(1);
                    });
                    tds[i].addEventListener('drop', tds[i].d2=function (e) {
                        e.preventDefault();
                        fromi=parseInt(e.dataTransfer.getData('fromi'));
                        ishand=e.dataTransfer.getData('hand')
                        //console.log(fromi,ishand);
                        lastcol=this.i-7;
                        if (lastcol<0) {
                            lastcol=-1;
                        }
                        if (ishand==true) {
                            //console.log(1);
                            if (lastcol!=-1 && ((handcard.color=='r' && fieldcards[lastcol].color=='b') || (fieldcards[lastcol].color=='r' && handcard.color=='b'))) {
                                if (handcard.number+1==fieldcards[lastcol].number) {
                                    console.log(handcard.number,fieldcards[lastcol].number);
                                    //console.log(this.i,e.dataTransfer.getData('fromi'));
                                    tmp=handcard;
                                    handcard=undefined;
                                    handcard=undefined
                                    hand.innerHTML='';
                                    fieldcards[this.i]=undefined;
                                    fieldcards[this.i]=tmp;
                                    update();
                                }
                            }
                            
                        } else {
                            
                            //console.log(fromi,lastcol);
                            if (lastcol!=-1 && ((fieldcards[fromi].color=='r' && fieldcards[lastcol].color=='b') || (fieldcards[lastcol].color=='r' && fieldcards[fromi].color=='b'))) {
                                
                                if (fieldcards[fromi].number+1==fieldcards[lastcol].number) {
                                    //console.log(this.i,e.dataTransfer.getData('fromi'));
                                    tmp=fieldcards[fromi];
                                    fieldcards[fromi]=undefined;
                                    fieldcards[this.i]=undefined;
                                    fieldcards[this.i]=tmp;
                                    update();
                                }
                            }
                        }
                    });
                }
            }
            }
            
            row++;
            if (row>=7) {
                row=0;
                col++;
            }
        }
         
        for (i=0;i<tds.length;i++) {
            if (fieldcards[i]!=undefined) {
                if (fieldcards[i].up==false) {
                    tds[i].innerHTML='&#127136;'
                    tds[i].style.color='lightblue';
                } else {
                    suit=''
                    if (fieldcards[i].suit=='S') {
                        suit='&#9824;';
                        tds[i].style.color='black';
                    }
                    if (fieldcards[i].suit=='H') {
                        suit='&#9829;';
                        tds[i].style.color='#a33';
                        
                    }
                    if (fieldcards[i].suit=='C') {
                        suit='&#9827;';
                        tds[i].style.color='black';
                        
                    }
                    if (fieldcards[i].suit=='D') {
                        suit='&#9830;';
                        tds[i].style.color='#a33';
                        
                    }
                    
                tds[i].innerHTML=fieldcards[i].face+''+suit
                }
            } else {
                tds[i].innerHTML='';
            }
        }
         
        function update() {
        row=0;
        col=0;
         
        rz=[];
        pz=[];
         
        for (i=0;i<tds.length;i++) {
        tds[i].style.backgroundColor='#229933';
        }
        for (i=0;i<tds.length;i++) {
            tds[i].removeEventListener('drop',tds[i].d2);
            tds[i].removeEventListener('dragover',tds[i].d1);
            tds[i].removeEventListener('dragstart',tds[i].d3);
            tds[i].setAttribute('draggable','false');
            
            nextcol=i+7;
            if (nextcol>tds.length-1) {
                nextcol=-1;
            }
            
            if (nextcol!=-1 && fieldcards[nextcol]==undefined && fieldcards[i]!=undefined) {
                fieldcards[i].up=true;
            }
            
            if (col==0 && fieldcards[i]==undefined) {
                //console.log(row,col);
                //tds[i].style.backgroundColor='#fff';
                    tds[i].addEventListener('dragover',tds[i].d1=function (e) {
                        e.preventDefault();
                        //console.log(1);
                    });
                    if (col==0) {
                        tds[i].addEventListener('drop', tds[i].d2=function (e) {
                            e.preventDefault();
                            fromi=parseInt(e.dataTransfer.getData('fromi'));
                            ishand=e.dataTransfer.getData('hand')
                            isstack=e.dataTransfer.getData('stack');
                            if (isstack==true) {
                                
                                    if (fieldcards[fromi].number==12) {
                                        
                                            console.log(fromi);
                                            for (z=0;z<13;z++) {
                                            tmp=fieldcards[fromi+(z*7)];
                                            fieldcards[fromi+(z*7)]=undefined;
                                            fieldcards[this.i+(z*7)]=undefined;
                                            fieldcards[this.i+(z*7)]=tmp;
                                            }
                                            update();
                                        }
                                    
                            } else {
                                
                                if (ishand==true) {
                                    if (handcard.number==12) {
                                    
                                    //console.log(1);
                                
                                            tmp=handcard;
                                            handcard=undefined;
                                            handcard=undefined
                                            hand.innerHTML='';
                                            fieldcards[this.i]=undefined;
                                            fieldcards[this.i]=tmp;
                                            update();
                                            
                                            handshift();
                                        }
                                    } else {
                                        if (fieldcards[fromi].number==12) {
                                            //console.log(this.i,e.dataTransfer.getData('fromi'));
                                            tmp=fieldcards[fromi];
                                            fieldcards[fromi]=undefined;
                                            fieldcards[this.i]=undefined;
                                            fieldcards[this.i]=tmp;
                                            update();
                                        }
                                        
                                    }
                                }
                                
                            });
                            
                    }
            }
            //console.log(pz[row]);
            rz[row]=fieldcards[i];
            //console.log(rz[row]);
            if (rz[row]==undefined && pz[row]!=undefined) {
                //console.log(row,col);
                
                //tds[i].style.backgroundColor='#fff';
                    tds[i].addEventListener('dragover',tds[i].d1=function (e) {
                        e.preventDefault();
                        //console.log(1);
                    });
                    tds[i].addEventListener('drop', tds[i].d2=function (e) {
                        e.preventDefault();
                        fromi=parseInt(e.dataTransfer.getData('fromi'));
                        ishand=e.dataTransfer.getData('hand')
                        isstack=e.dataTransfer.getData('stack')
                       // console.log(fromi,ishand);
                        lastcol=this.i-7;
                        if (lastcol<0) {
                            lastcol=-1;
                        }
                        if (isstack==true) {
                             if (lastcol!=-1 && ((fieldcards[fromi].color=='r' && fieldcards[lastcol].color=='b') || (fieldcards[lastcol].color=='r' && fieldcards[fromi].color=='b'))) {
                                    
                                    if (fieldcards[fromi].number+1==fieldcards[lastcol].number) {
                                        console.log(fromi);
                                        for (z=0;z<13;z++) {
                                        tmp=fieldcards[fromi+(z*7)];
                                        fieldcards[fromi+(z*7)]=undefined;
                                        fieldcards[this.i+(z*7)]=undefined;
                                        fieldcards[this.i+(z*7)]=tmp;
                                        }
                                        update();
                                    }
                                }
                        } else {
                            if (ishand==true) {
                            //  console.log(1);
                                if (lastcol!=-1 && ((handcard.color=='r' && fieldcards[lastcol].color=='b') || (fieldcards[lastcol].color=='r' && handcard.color=='b'))) {
                                    if (handcard.number+1==fieldcards[lastcol].number) {
                                        //console.log(this.i,e.dataTransfer.getData('fromi'));
                                        tmp=handcard;
                                        handcard=undefined;
                                        handcard=undefined
                                        hand.innerHTML='';
                                        fieldcards[this.i]=undefined;
                                        fieldcards[this.i]=tmp;
                                        update();
                                        
                                        handshift();
                                    }
                                }
                                
                            } else {
                                
                                //console.log(fromi,lastcol);
                                if (lastcol!=-1 && ((fieldcards[fromi].color=='r' && fieldcards[lastcol].color=='b') || (fieldcards[lastcol].color=='r' && fieldcards[fromi].color=='b'))) {
                                    
                                    if (fieldcards[fromi].number+1==fieldcards[lastcol].number) {
                                        //console.log(this.i,e.dataTransfer.getData('fromi'));
                                        tmp=fieldcards[fromi];
                                        fieldcards[fromi]=undefined;
                                        fieldcards[this.i]=undefined;
                                        fieldcards[this.i]=tmp;
                                        update();
                                    }
                                }
                            }
                        }
                    });
            }
            //if (nextcol!=-1 && fieldcards[nextcol]!=undefined && fieldcards[i].up==true) {
              //  console.log(row,col);
                
            //}
            pz[row]=fieldcards[i];
            
            if (fieldcards[i]!=undefined) {
                if (fieldcards[i].up==false) {
                    tds[i].innerHTML='&#127136;'
                    tds[i].style.color='lightblue';
                } else {
                    suit=''
                    if (fieldcards[i].suit=='S') {
                        suit='&#9824;';
                        tds[i].style.color='black';
                    }
                    if (fieldcards[i].suit=='H') {
                        suit='&#9829;';
                        tds[i].style.color='#a33';
                        
                    }
                    if (fieldcards[i].suit=='C') {
                        suit='&#9827;';
                        tds[i].style.color='black';
                        
                    }
                    if (fieldcards[i].suit=='D') {
                        suit='&#9830;';
                        tds[i].style.color='#a33';
                        
                    }
                    
                tds[i].innerHTML=fieldcards[i].face+''+suit
                }
            } else {
                tds[i].innerHTML='';
            }
            
            row++;
            if (row>=7) {
                row=0;
                col++;
            }
        }
         
        for (i=0;i<tds.length;i++) {
            nextcol=i+7;
            if (nextcol>tds.length-1) {
                nextcol=-1;
            }
            
            if (nextcol!=-1 && fieldcards[nextcol]==undefined && fieldcards[i]!=undefined) {
                
                tds[i].setAttribute('draggable','true');
                tds[i].addEventListener('dragstart',tds[i].d3=function (e) {
                    e.dataTransfer.setData('fromi',this.i);
                });
            }
            if (nextcol!=-1 && fieldcards[nextcol]!=undefined && fieldcards[i].up==true) {
            //tds[i].style.backgroundColor='#fff'
            tds[i].setAttribute('draggable','true');
                tds[i].addEventListener('dragstart',tds[i].d3=function (e) {
                    e.dataTransfer.setData('fromi',this.i);
                    e.dataTransfer.setData('stack',1);
                });
                //console.log(row,col);
                
            }
        }
         
        }
        hand=document.getElementById('hand');
        deck=document.getElementById('deck');
        handcard=cards.pop();
        hand.i=0
        handcard.up=true;
        suit=''
        if (handcard.suit=='S') {
            suit='&#9824;';
            hand.style.color='black';
        }
        if (handcard.suit=='H') {
            suit='&#9829;';
            hand.style.color='#a33';
            
        }
        if (handcard.suit=='C') {
            suit='&#9827;';
            hand.style.color='black';
            
        }
        if (handcard.suit=='D') {
            suit='&#9830;';
            hand.style.color='#a33';
            
        }
         
        hand.innerHTML=handcard.face+''+suit
        hand.setAttribute('draggable','true');
        hand.addEventListener('dragstart',hand.d3=function (e) {
            e.dataTransfer.setData('fromi',this.i);
            e.dataTransfer.setData('hand',1);
        });
        function handshift() {
            handcard=cards.shift();
            hand.i=0
            handcard.up=true;
            suit=''
            if (handcard.suit=='S') {
                suit='&#9824;';
                hand.style.color='black';
            }
            if (handcard.suit=='H') {
                suit='&#9829;';
                hand.style.color='#a33';
                
            }
            if (handcard.suit=='C') {
                suit='&#9827;';
                hand.style.color='black';
                
            }
            if (handcard.suit=='D') {
                suit='&#9830;';
                hand.style.color='#a33';
                
            }
         
            hand.innerHTML=handcard.face+''+suit
            hand.setAttribute('draggable','true');
            hand.addEventListener('dragstart',hand.d3=function (e) {
                e.dataTransfer.setData('fromi',this.i);
                e.dataTransfer.setData('hand',1);
        });
        }
        deck.addEventListener('click',function () {
            if (handcard!=undefined) {
            cards.unshift(handcard);
            }
            handcard=undefined;
            handcard=cards.pop();
            hand.i=0
            handcard.up=true;
            suit=''
            if (handcard.suit=='S') {
                suit='&#9824;';
                hand.style.color='black';
            }
            if (handcard.suit=='H') {
                suit='&#9829;';
                hand.style.color='#a33';
                
            }
            if (handcard.suit=='C') {
                suit='&#9827;';
                hand.style.color='black';
                
            }
            if (handcard.suit=='D') {
                suit='&#9830;';
                hand.style.color='#a33';
                
            }
         
            hand.innerHTML=handcard.face+''+suit
            hand.setAttribute('draggable','true');
            hand.addEventListener('dragstart',hand.d3=function (e) {
                e.dataTransfer.setData('fromi',this.i);
                e.dataTransfer.setData('hand',1);
            });
            
        });
         
        fourtable=document.getElementById('four');
        ftds=fourtable.getElementsByTagName('td');
        fsuits=['H','D','C','S'];
        for (i=0;i<ftds.length;i++) {
            ftds[i].number=0;
            ftds[i].suit=fsuits[i];
            ftds[i].addEventListener('dragover',tds[i].d1=function (e) {
                e.preventDefault();
                        //console.log(1);
            });
            ftds[i].addEventListener('drop', tds[i].d2=function (e) {
                e.preventDefault();
                ishand=e.dataTransfer.getData('hand')
                fromi=parseInt(e.dataTransfer.getData('fromi'));
                if (ishand==true) {
                    //console.log(1);
                    if (handcard.suit==this.suit) {
                    if (handcard.number==this.number) {
                        suit=''
                        if (handcard.suit=='S') {
                            suit='&#9824;';
                            hand.style.color='black';
                        }
                        if (handcard.suit=='H') {
                            suit='&#9829;';
                            hand.style.color='#a33';
                            
                        }
                        if (handcard.suit=='C') {
                            suit='&#9827;';
                            hand.style.color='black';
                            
                        }
                        if (handcard.suit=='D') {
                            suit='&#9830;';
                            hand.style.color='#a33';
                            
                        }
                        this.innerHTML=handcard.face+''+suit
                        this.number++;
                        handcard=undefined;
                        hand.innerHTML=''
                        handshift();
                    }
                    }
                } else {
                //console.log(this.i,e.dataTransfer.getData('fromi'));
                if (fieldcards[fromi].suit==this.suit) {
                    if (fieldcards[fromi].number==this.number) {
                        suit=''
                        if (fieldcards[fromi].suit=='S') {
                            suit='&#9824;';
                            hand.style.color='black';
                        }
                        if (fieldcards[fromi].suit=='H') {
                            suit='&#9829;';
                            hand.style.color='#a33';
                            
                        }
                        if (fieldcards[fromi].suit=='C') {
                            suit='&#9827;';
                            hand.style.color='black';
                            
                        }
                        if (fieldcards[fromi].suit=='D') {
                            suit='&#9830;';
                            hand.style.color='#a33';
                            
                        }
                        this.innerHTML=fieldcards[fromi].face+''+suit
                        this.number++;
                        tmp=fieldcards[fromi];
                        fieldcards[fromi]=undefined;
                        fieldcards[this.i]=undefined;
                        fieldcards[this.i]=tmp;
                        update();
                    }
                
                    }
                }
                
            });
            
        }
         
        </script>
        </div>
        
</body>
<footer>
    <p>&copy; Jaya 2024-2025</p>
</footer>
</html>